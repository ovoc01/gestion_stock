package com.colasmadagascar.stockinventory.serviceexp;

import java.util.List;
import java.util.Optional;

import org.springframework.stereotype.Service;

import com.colasmadagascar.stockinventory.shared.Fetch;

import jakarta.transaction.Transactional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.PageRequest;

@Service

public class ServiceExploitantService {
    @Autowired
    ServiceExploitantRepository serviceRepository;

    public List<ServiceExploitant> getAllEntities(int page, int size,Fetch fetch ) {
        if (fetch == Fetch.ALL)
            return serviceRepository.findAll();
        Pageable pageable = PageRequest.of(page - 1, size);
        return serviceRepository.findAll(pageable).toList();
    }

    public Optional<ServiceExploitant> getEntityById(Long id) {
        return serviceRepository.findById(id);
    }

    public ServiceExploitant saveEntity(ServiceExploitant service) {
        return serviceRepository.save(service);
    }

    public ServiceExploitant updateEntity(ServiceExploitant service) {
        return serviceRepository.save(service);
    }

    public void deleteEntityById(Long id) {
        serviceRepository.deleteById(id);
    }

    public long count() {
        return serviceRepository.count();
    }

    @Transactional
    public void addUtilisateurToService(Long usrId, Long serviceId) {
        serviceRepository.addUtilisateurService(usrId, serviceId);
    }

    @Transactional
    public void addUtilisateurToServices(Long usrId, Long[] serviceId) {
        if (serviceId == null) return;
            for (Long id : serviceId) {
                serviceRepository.addUtilisateurService(usrId, id);
            }
    }

    public List<UtilisateurServiceDTO> getUtilisateurService(Long usrId) {
        return serviceRepository.getUtilisateurService(usrId);
    }

}